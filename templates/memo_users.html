{% extends 'base.html' %}

{% block title %}ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - Ù…ÙŠÙ…Ùˆ{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-12">
  <div class="bg-white dark:bg-gray-900 shadow-2xl rounded-3xl p-8 border border-gray-200 dark:border-gray-700">

    <!-- âœ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
    <div class="text-center mb-10">
      <h3 class="text-4xl font-extrabold text-blue-600 dark:text-blue-400 mb-3 tracking-wide">
        ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      </h3>
      <p class="text-gray-500 dark:text-gray-400 text-base">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø´Ø§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</p>
    </div>

    <!-- ğŸ” Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-10">
      <a href="{{ url_for('add_user') }}" 
         class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 
                text-white font-semibold py-3 px-6 rounded-2xl shadow-lg text-sm transition transform hover:scale-105 hover:shadow-xl">
        â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
      </a>

      <div class="relative w-full md:w-1/2">
        <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…..."
               class="w-full border border-gray-300 dark:border-gray-600 rounded-2xl px-4 py-3 pl-12 text-sm 
                      focus:ring-2 focus:ring-blue-400 dark:bg-gray-800 dark:text-white shadow-sm transition">
        <span class="absolute left-4 top-3 text-gray-400">ğŸ”</span>
      </div>
    </div>

    <!-- ğŸ§¾ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
    <div class="overflow-x-auto rounded-2xl border border-gray-200 dark:border-gray-700 shadow-md">
      <table class="min-w-full table-auto text-center">
        <thead class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-gray-800 dark:to-gray-700 
                       text-blue-800 dark:text-blue-200 font-semibold text-sm">
          <tr>
            <th class="py-4 px-3">#</th>
            <th class="py-4 px-3">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
            <th class="py-4 px-3">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
            <th class="py-4 px-3">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
            <th class="py-4 px-3">Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</th>
            <th class="py-4 px-3">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="usersTable" class="divide-y divide-gray-200 dark:divide-gray-700 text-sm">
          {% for user in users %}
          <tr class="hover:bg-gray-50 dark:hover:bg-gray-800 transition">
            <td class="py-4 px-3 font-medium text-gray-700 dark:text-gray-300">{{ user.id }}</td>
            <td class="py-4 px-3 flex justify-center items-center gap-2 font-semibold text-gray-800 dark:text-gray-100">
              {{ user.username }}
              {% if user.verified %}
              <span class="text-blue-500" title="Ù…ÙˆØ«Ù‚">âœ”ï¸</span>
              {% endif %}
            </td>
            <td class="py-4 px-3 text-gray-600 dark:text-gray-300">{{ user.email or 'â€”' }}</td>
            <td class="py-4 px-3 text-gray-600 dark:text-gray-300">{{ user.first_name }} {{ user.last_name }}</td>
            <td class="py-4 px-3 font-bold text-blue-600 dark:text-blue-400 flex flex-col items-center">
              <span id="followers-count-{{ user.id }}">{{ user.followers.count() }}</span>

<!-- ğŸ“ˆ Ù…ØªØ§Ø¨Ø¹ + -->
<form onsubmit="increaseFollowers(event, '{{ user.id }}')" class="flex items-center gap-2 mt-2">
  <input type="number" name="amount" min="1" value="1"
         class="w-16 px-2 py-1 rounded-xl border text-center dark:bg-gray-700 dark:text-white text-xs">
  <button type="submit" 
          class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-xl shadow-md text-xs transition">ğŸ“ˆ +</button>
</form>
</td>
            <td class="py-4 px-3 flex flex-wrap justify-center gap-2">

              <!-- ØªØ¹Ø¯ÙŠÙ„ -->
              <a href="{{ url_for('edit_user', user_id=user.id) }}"
                 class="bg-yellow-400 hover:bg-yellow-500 text-white px-4 py-2 rounded-xl shadow-md text-xs transition">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>

              <!-- Ø­Ø°Ù -->
              <form method="post" action="{{ url_for('delete_user', user_id=user.id) }}"
                    onsubmit="return confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ');">
                <button type="submit" 
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl shadow-md text-xs transition">ğŸ—‘ Ø­Ø°Ù</button>
              </form>

              <!-- ØªÙˆØ«ÙŠÙ‚ -->
              {% if user.verified %}
              <form method="post" action="{{ url_for('unverify_user_route', user_id=user.id) }}">
                <button type="submit" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded-xl shadow-md text-xs transition">âŒ Ø¥Ù„ØºØ§Ø¡</button>
              </form>
              {% else %}
              <form method="post" action="{{ url_for('verify_user_route', user_id=user.id) }}">
                <button type="submit" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-xl shadow-md text-xs transition">âœ”ï¸ ØªÙˆØ«ÙŠÙ‚</button>
              </form>
              {% endif %}

              <!-- Ø­Ø¸Ø± -->
              <a href="{{ url_for('memo_ban_form') }}?username={{ user.username }}"
                 class="bg-black hover:bg-gray-800 text-white px-4 py-2 rounded-xl shadow-md text-xs transition">ğŸ”’ Ø­Ø¸Ø±</a>

            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="py-8 text-center text-gray-500 dark:text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- ğŸ“‘ Pagination -->
    {% if pagination %}
    <div class="flex justify-center items-center mt-8 gap-4">
      {% if pagination.has_prev %}
        <a href="{{ url_for('manage_users', page=pagination.prev_num) }}"
           class="px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-xl text-sm transition">â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
      {% endif %}

      <span class="px-4 py-2 bg-blue-600 text-white rounded-xl shadow-md text-sm">
        ØµÙØ­Ø© {{ pagination.page }} Ù…Ù† {{ pagination.pages }}
      </span>

      {% if pagination.has_next %}
        <a href="{{ url_for('manage_users', page=pagination.next_num) }}"
           class="px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-xl text-sm transition">Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</a>
      {% endif %}
    </div>
    {% endif %}

  </div>
</div>

<!-- ğŸ” Ø¨Ø­Ø« -->
<script>
  const searchInput = document.getElementById("searchInput");
  searchInput.addEventListener("keyup", function () {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll("#usersTable tr");
    rows.forEach(function (row) {
      const usernameCell = row.cells[1];
      if (usernameCell) {
        const username = usernameCell.textContent.toLowerCase();
        row.style.display = username.includes(filter) ? "" : "none";
      }
    });
  });
</script>

<!-- ğŸ“ˆ Ù…ØªØ§Ø¨Ø¹Ø© -->
<script>
  function increaseFollowers(event, userId) {
    event.preventDefault();
    const form = event.target;
    const amount = form.querySelector("input[name='amount']").value;

    fetch('/increase_followers/' + userId, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: 'amount=' + encodeURIComponent(amount)
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.getElementById('followers-count-' + userId).innerText = data.followers;
        form.querySelector("input[name='amount']").value = 1; // ÙŠØ±Ø¬Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¥Ù„Ù‰ 1 Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
      } else {
        alert('ÙØ´Ù„ ÙÙŠ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†.');
      }
    })
    .catch(error => {
      console.error('Ø®Ø·Ø£:', error);
    });
  }
</script>
{% endblock %}