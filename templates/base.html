<!DOCTYPE html>
<html lang="ar" dir="rtl">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>{% block title %}ØªØ·Ø¨ÙŠÙ‚ÙŠ{% endblock %}</title>  

  <!-- âœ… Tailwind CSS -->  
  <script src="https://cdn.tailwindcss.com"></script>  
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">  

  <style>  
    body { font-family: 'Cairo', sans-serif; }  
    [dir="rtl"] .toast { direction: rtl; }  

    /* ØªØ£Ø«ÙŠØ± Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠ */
    .nav-icon { transition: transform 0.2s ease, color 0.2s ease; }
    .nav-icon:hover { transform: scale(1.2); color: #fbbf24; }
  </style>  
</head>  

<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-white">  

  <!-- âœ… ØºØ·Ø§Ø¡ Ø®Ù„ÙÙŠ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© -->  
  <div id="backdrop" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40" onclick="closeMenu()"></div>  

  <!-- âœ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->  
  <aside id="sideMenu"  
         class="fixed top-0 right-0 w-72 sm:w-80 h-full bg-gradient-to-b from-gray-800 to-gray-900 text-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 p-6 space-y-6 rounded-l-3xl overflow-y-auto">  
    <div class="flex justify-between items-center">  
      <h2 class="text-2xl font-bold">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>  
      <button onclick="closeMenu()" class="text-white text-3xl">&times;</button>  
    </div>  
    <nav class="space-y-4 text-lg">  
      <a href="{{ url_for('public_profile', username=session['username']) }}" class="block hover:text-yellow-400">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
      <a href="{{ url_for('contact') }}" class="block hover:text-yellow-400">ğŸ“ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>  
      <a href="{{ url_for('settings') }}" class="block hover:text-yellow-400">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>  
      <a href="{{ url_for('upgrade_premium') }}" class="block hover:text-yellow-400 font-semibold">ğŸ’ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</a>  

      {% if current_user.is_authenticated %}  
        <a href="{{ url_for('logout') }}" class="block hover:text-yellow-400">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>  
      {% else %}  
        <a href="{{ url_for('login') }}" class="block hover:text-yellow-400">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>  
      {% endif %}  

      <!-- âœ… Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø¯Ù…Ù† -->
      {% if current_user.is_authenticated and current_user.is_admin %}
        <hr class="border-gray-700">
        <div class="space-y-3 mt-4">
          <h3 class="text-lg font-semibold text-yellow-400">âš¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
          <a href="{{ url_for('memo_dashboard') }}" class="block hover:text-yellow-400">ğŸ“ Ù„ÙˆØ­Ø© Ù…ÙŠÙ…Ùˆ</a>
          <a href="{{ url_for('memo_users') }}" class="block hover:text-yellow-400">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a>
          <a href="{{ url_for('admin_list') }}" class="block hover:text-yellow-400">ğŸ›¡ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯Ù…Ù†</a>
        </div>
      {% endif %}
    </nav>  
  </aside>  

  <!-- âœ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->  
  <div class="max-w-screen-xl mx-auto mt-4 px-4">  
    {% with messages = get_flashed_messages(with_categories=true) %}  
      {% if messages %}  
        {% for category, message in messages %}  
        <div class="mb-4 px-4 py-3 rounded bg-{{ 'red' if category == 'danger' else 'green' }}-100 text-{{ 'red' if category == 'danger' else 'green' }}-800">  
          {{ message }}  
        </div>  
        {% endfor %}  
      {% endif %}  
    {% endwith %}  
  </div>  

  <!-- âœ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->  
  <div class="max-w-screen-xl mx-auto px-4 pb-24">  
    {% block content %}{% endblock %}  
  </div>  

<!-- âœ… Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ -->
<nav class="fixed bottom-0 inset-x-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-50 rounded-t-3xl">  
  <div class="max-w-screen-xl mx-auto flex justify-around items-center py-2 text-xs sm:text-sm md:text-base">  

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->  
    <button onclick="openMenu()" class="flex flex-col items-center nav-icon">  
      <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"  
           viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"  
                                      d="M4 6h16M4 12h16M4 18h16" /></svg>  
      <span></span>  
    </button>  

    <!-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->  
    <a href="{{ url_for('home') }}" class="flex flex-col items-center nav-icon">  
      <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"  
           viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"  
                                      d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /></svg>  
      <span></span>  
    </a>  

    <!-- Ø§Ø³ØªÙƒØ´Ø§Ù -->  
    <a href="{{ url_for('explore_page') }}" class="flex flex-col items-center nav-icon">  
      <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"  
           viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"  
                                      d="M12 2l9 21-9-5-9 5 9-21z" /></svg>  
      <span></span>  
    </a>  

    <!-- Ø§Ù„Ø¨Ø­Ø« -->  
    <a href="{{ url_for('search') }}" class="flex flex-col items-center nav-icon">  
      <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"  
           viewBox="0 0 24 24">  
        <circle cx="11" cy="11" r="8" />  
        <line x1="21" y1="21" x2="16.65" y2="16.65" />  
      </svg>  
      <span></span>  
    </a>  

    <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªÙ„ÙŠØ¬Ø±Ø§Ù…) -->  
    <a href="{{ url_for('inbox') }}" class="flex flex-col items-center nav-icon relative">  
      <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" viewBox="0 0 24 24" fill="currentColor">  
        <path d="M22 2L11 13" />  
        <path d="M22 2L15 22L11 13L2 9L22 2Z" />  
      </svg>  
      <span></span>  
      {% if unread_messages_count > 0 %}  
        <span id="msg-notify" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full">  
          {{ unread_messages_count }}  
        </span>  
      {% endif %}  
    </a>  

    <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->  
    <a href="{{ url_for('notifications') }}" class="flex flex-col items-center nav-icon relative">  
      <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"  
           viewBox="0 0 24 24">  
        <path stroke-linecap="round" stroke-linejoin="round"  
              d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />  
      </svg>  
      <span>
      </span>  
      {% if has_unread_notifications %}  
        <span class="absolute top-1 right-2 w-2 h-2 bg-red-500 rounded-full animate-ping"></span>  
      {% endif %}  
    </a>  

  </div>  
</nav>

  <!-- âœ… Scripts -->  
  <script>  
    function openMenu() {  
      document.getElementById('sideMenu').classList.remove('translate-x-full');  
      document.getElementById('backdrop').classList.remove('hidden');  
    }  
    function closeMenu() {  
      document.getElementById('sideMenu').classList.add('translate-x-full');  
      document.getElementById('backdrop').classList.add('hidden');  
    }  
  </script>  

  <!-- âœ… Bootstrap & Socket.IO -->  
  <script src="{{ url_for('static', filename='libs/bootstrap.bundle.min.js') }}"></script>  
  <script src="{{ url_for('static', filename='libs/socket.io.min.js') }}"></script>  

  <!-- âœ… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->  
  <script>  
    document.addEventListener("DOMContentLoaded", function () {  
      const socket = io();  
      const username = "{{ current_user.username if current_user.is_authenticated else '' }}";  

      if (username !== "") {  
        socket.emit("join", { room: username });  
        socket.on("new_message", function (data) {  
          showToast(`Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† ${data.from}: ${data.text}`);  
          const msgIcon = document.getElementById("msg-notify");  
          if (msgIcon) msgIcon.classList.remove("hidden");  
        });  
        socket.on("new_notification", function (data) {  
          showToast(data.message);  
        });  
      }  

      function showToast(message) {  
        const toast = document.createElement("div");  
        toast.className = "toast fixed bottom-5 right-5 bg-green-600 text-white px-4 py-2 rounded shadow-lg z-50";  
        toast.innerText = message;  
        document.body.appendChild(toast);  
        setTimeout(() => toast.remove(), 5000);  
      }  
    });  
  </script>  

</body>  
</html>