<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}ØªØ·Ø¨ÙŠÙ‚ÙŠ{% endblock %}</title>

  <!-- âœ… Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Cairo', sans-serif; }
    [dir="rtl"] .toast { direction: rtl; }

    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
    .nav-icon { transition: transform 0.25s ease, color 0.25s ease; }
    .nav-icon:hover { transform: scale(1.25) rotate(-6deg); color: #facc15; }
  </style>
</head>

<body class="bg-gradient-to-b from-gray-100 to-gray-200 text-gray-900 dark:from-gray-900 dark:to-gray-950 dark:text-white transition-colors duration-500 ease-in-out">

  <!-- âœ… ØºØ·Ø§Ø¡ Ø®Ù„ÙÙŠ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© -->
  <div id="backdrop" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-40 transition-opacity duration-500" onclick="closeMenu()"></div>

  <!-- âœ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
  <aside id="sideMenu"
         class="fixed top-0 right-0 w-72 sm:w-80 h-full bg-gradient-to-b from-gray-800 via-gray-900 to-black text-white shadow-2xl transform translate-x-full transition-transform duration-500 ease-in-out z-50 p-6 space-y-6 rounded-l-3xl overflow-y-auto">
    <div class="flex justify-between items-center">
      <h2 class="text-2xl font-bold tracking-wide">âœ¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
      <button onclick="closeMenu()" class="text-white text-3xl hover:text-yellow-400 transition-colors">&times;</button>
    </div>
    <nav class="space-y-4 text-lg font-medium">

      <a href="{{ url_for('public_profile', username=session['username']) }}" class="flex items-center gap-2 hover:text-yellow-400 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 15c2.486 0 4.797.676 6.879 1.804M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
      </a>

      <a href="{{ url_for('contact') }}" class="flex items-center gap-2 hover:text-yellow-400 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h2l3.6 7.59a1 1 0 00.9.41H17a1 1 0 010 2h-6a1 1 0 00-.9.55L9 19H5a2 2 0 01-2-2V5z" />
        </svg>
        ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§
      </a>

      <a href="{{ url_for('settings') }}" class="flex items-center gap-2 hover:text-yellow-400 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3a6.75 6.75 0 010 13.5A6.75 6.75 0 019.75 3zm0 0V1.5M9.75 16.5V18M3 9.75H1.5M16.5 9.75H18" />
        </svg>
        Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      </a>

      <a href="{{ url_for('upgrade_premium') }}" class="flex items-center gap-2 hover:text-yellow-400 font-semibold">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3l2.09 6.26H21l-4.91 3.58L17.18 21 12 16.77 6.82 21l1.09-8.16L3 9.26h6.91L12 3z" />
        </svg>
        Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
      </a>

      {% if current_user.is_authenticated %}
        <a href="{{ url_for('logout') }}" class="flex items-center gap-2 hover:text-yellow-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1m0-10V5m0 14a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2h4a2 2 0 012 2v1" />
          </svg>
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </a>
      {% else %}
        <a href="{{ url_for('login') }}" class="flex items-center gap-2 hover:text-yellow-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0-1.105.895-2 2-2h6V7l4 4-4 4v-2h-6a2 2 0 01-2-2z" />
          </svg>
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </a>
      {% endif %}

      {% if current_user.is_authenticated and current_user.is_admin %}
        <hr class="border-gray-700 my-4">
        <div class="space-y-3">
          <h3 class="text-lg font-semibold text-yellow-400 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
          </h3>

          <a href="{{ url_for('memo_dashboard') }}" class="flex items-center gap-2 hover:text-yellow-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6M9 16h6M9 20h6" />
            </svg>
            Ù„ÙˆØ­Ø© Ù…ÙŠÙ…Ùˆ
          </a>

          <a href="{{ url_for('memo_users') }}" class="flex items-center gap-2 hover:text-yellow-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a4 4 0 00-5-4M9 20H4v-2a4 4 0 015-4m0-4a4 4 0 100-8 4 4 0 000 8z" />
            </svg>
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
          </a>

          <a href="{{ url_for('admin_list') }}" class="flex items-center gap-2 hover:text-yellow-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 nav-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0-1.105.895-2 2-2h6V7l4 4-4 4v-2h-6a2 2 0 01-2-2z" />
            </svg>
            Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯Ù…Ù†
          </a>
        </div>
      {% endif %}
    </nav>
  </aside>

  <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± -->

  <!-- âœ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
  <div class="max-w-screen-xl mx-auto mt-4 px-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
        <div class="mb-4 px-4 py-3 rounded-lg shadow-lg transform transition-all duration-500 hover:scale-[1.02] bg-{{ 'red' if category == 'danger' else 'green' }}-100 text-{{ 'red' if category == 'danger' else 'green' }}-800">
          {{ message }}
        </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <!-- âœ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div class="max-w-screen-xl mx-auto px-4 pb-24 animate-fadeIn">
    {% block content %}{% endblock %}
  </div>

  <!-- âœ… Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
  <nav class="fixed bottom-0 inset-x-0 bg-white/90 dark:bg-gray-800/90 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 shadow-2xl z-50 rounded-t-3xl">
    <div class="max-w-screen-xl mx-auto flex justify-around items-center py-3 text-xs sm:text-sm md:text-base">

      <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
      <button onclick="openMenu()" class="flex flex-col items-center nav-icon">
        <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
                                        d="M4 6h16M4 12h16M4 18h16" /></svg>
      </button>

      <!-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <a href="{{ url_for('home') }}" class="flex flex-col items-center nav-icon">
        <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
                                        d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /></svg>
      </a>

      <!-- Ø§Ø³ØªÙƒØ´Ø§Ù -->
      <a href="{{ url_for('explore_page') }}" class="flex flex-col items-center nav-icon">
        <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
                                        d="M12 2l9 21-9-5-9 5 9-21z" /></svg>
      </a>

      <!-- Ø§Ù„Ø¨Ø­Ø« -->
      <a href="{{ url_for('search') }}" class="flex flex-col items-center nav-icon">
        <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
      </a>

      <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
      <a href="{{ url_for('inbox') }}" class="flex flex-col items-center nav-icon relative">
        <svg class="w-7 h-7 mb-1" viewBox="0 0 24 24" fill="currentColor">
          <path d="M22 2L11 13" />
          <path d="M22 2L15 22L11 13L2 9L22 2Z" />
        </svg>
        {% if unread_messages_count > 0 %}
          <span id="msg-notify" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full shadow-md animate-bounce">
            {{ unread_messages_count }}
          </span>
        {% endif %}
      </a>

      <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
      <a href="{{ url_for('notifications') }}" class="flex flex-col items-center nav-icon relative">
        <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
        {% if has_unread_notifications %}
          <span class="absolute top-1 right-2 w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
        {% endif %}
      </a>

    </div>
  </nav>

  <!-- âœ… Scripts -->
  <script>
    function openMenu() {
      document.getElementById('sideMenu').classList.remove('translate-x-full');
      document.getElementById('backdrop').classList.remove('hidden');
    }
    function closeMenu() {
      document.getElementById('sideMenu').classList.add('translate-x-full');
      document.getElementById('backdrop').classList.add('hidden');
    }
  </script>

  <script src="{{ url_for('static', filename='libs/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='libs/socket.io.min.js') }}"></script>

  <!-- âœ… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const socket = io();
      const username = "{{ current_user.username if current_user.is_authenticated else '' }}";

      if (username !== "") {
        socket.emit("join", { room: username });
        socket.on("new_message", function (data) {
          showToast(`ğŸ“© Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† ${data.from}: ${data.text}`);
          const msgIcon = document.getElementById("msg-notify");
          if (msgIcon) msgIcon.classList.remove("hidden");
        });
        socket.on("new_notification", function (data) {
          showToast(`ğŸ”” ${data.message}`);
        });
      }

      function showToast(message) {
        const toast = document.createElement("div");
        toast.className = "toast fixed bottom-5 right-5 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-lg shadow-2xl z-50 animate-slideIn";
        toast.innerText = message;
        document.body.appendChild(toast);
        setTimeout(() => {
          toast.classList.add("opacity-0", "translate-y-3", "transition-all", "duration-700");
          setTimeout(() => toast.remove(), 700);
        }, 4000);
      }
    });
  </script>

  <!-- âœ… Animations -->
  <style>
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    .animate-fadeIn { animation: fadeIn 0.8s ease-in-out; }

    @keyframes slideIn { from {transform: translateX(100%); opacity: 0;} to {transform: translateX(0); opacity: 1;} }
    .animate-slideIn { animation: slideIn 0.6s ease-out; }
  </style>

</body>
</html>