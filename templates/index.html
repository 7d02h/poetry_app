<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ø¬Ø²ÙŠØ±Ø© Ø§Ù„Ø¹Ø±Ø¨</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
  <div id="menuToggle" onclick="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
  <nav id="sideMenu">
    <ul>
      <li><a href="{{ url_for('my_profile') }}">ğŸ‘¤ ØµÙØ­ØªÙŠ</a></li>
      <li><a href="#">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
      <li><a href="#">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
      <li><a href="{{ url_for('set_language', lang_code='ar') }}">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</a></li>
      <li><a href="{{ url_for('set_language', lang_code='en') }}">ğŸ‡¬ğŸ‡§ English</a></li>
      <li><a href="{{ url_for('logout') }}">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
    </ul>
  </nav>

  <div class="container">
    <h1>Ø¬Ø²ÙŠØ±Ø© Ø§Ù„Ø¹Ø±Ø¨</h1>

    <div style="text-align: right; margin-bottom: 20px;">
      Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ <a href="{{ url_for('my_profile') }}">{{ username }}</a> |
      <a href="{{ url_for('logout') }}">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- Ø£ÙØ¶Ù„ Ù£ Ø£Ø¨ÙŠØ§Øª -->
    <section>
      <h2>ğŸŒŸ Ø£ÙØ¶Ù„ Ù£ Ø£Ø¨ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h2>
      {% if top_poems %}
        {% for poem in top_poems %}
          <div class="poem">
            <p>{{ poem[1] }}</p>
            <p class="timestamp">{{ poem[5] }}</p>
            <div class="user-info">
              <img src="{{ url_for('static', filename='profile_pics/' + poem[4]) }}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
              <a href="{{ url_for('public_profile', username=poem[3]) }}">{{ poem[3] }}</a>
            </div>
            <div class="poem-footer">
              â¤ï¸ {{ poem[2] }}
              {% if poem[3] == username %}
              <a href="{{ url_for('like', poem_id=poem[0], like_count=1) }}">â¤ï¸ Like</a>
                | <a href="{{ url_for('delete', poem_id=poem[0]) }}">ğŸ—‘ï¸ Ø­Ø°Ù</a>
              {% endif %}
              | <a href="#" onclick="sharePoem({{ poem[1]|escape }})">ğŸŒğŸ» Ù…Ø´Ø§Ø±ÙƒØ©</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø§Ù„ÙŠÙˆÙ….</p>
      {% endif %}
    </section>

    <!-- Ù†Ø´Ø± Ø¨ÙŠØª -->
    <section>
      <h2>âœï¸ Ø§Ù†Ø´Ø± Ø¨ÙŠØªÙƒ</h2>
      <form action="{{ url_for('submit') }}" method="POST">
        <textarea name="text" placeholder="Ø§ÙƒØªØ¨ Ø¨ÙŠØªÙƒ Ø§Ù„Ø´Ø¹Ø±ÙŠ Ù‡Ù†Ø§..." required></textarea>
        <button type="submit">Ù†Ø´Ø±</button>
      </form>
    </section>

    <!-- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¨ÙŠØ§Øª -->
    <section>
      <h2>ğŸ“š ÙƒÙ„ Ø§Ù„Ø£Ø¨ÙŠØ§Øª</h2>
      {% if all_poems %}
        {% for poem in all_poems %}
          <div class="poem">
            <p>{{ poem[1] }}</p>
            <p class="timestamp">{{ poem[5] }}</p>
            <div class="user-info">
              <img src="{{ url_for('static', filename='profile_pics/' + poem[4]) }}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
              <a href="{{ url_for('public_profile', username=poem[3]) }}">{{ poem[3] }}</a>
            </div>
            <div class="poem-footer">
              <a href="{{ url_for('like', poem_id=poem[0], like_count=1) }}">â¤ï¸ Like</a>
              {% if poem[3] == username %}
                | <a href="{{ url_for('delete', poem_id=poem[0]) }}">ğŸ—‘ï¸ Ø­Ø°Ù</a>
              {% endif %}
              | <a href="#" onclick="sharePoem({{ poem[1]|escape }})">ğŸŒğŸ» Ù…Ø´Ø§Ø±ÙƒØ©</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¨ÙŠØ§Øª Ù…Ù†Ø´ÙˆØ±Ø© Ø¨Ø¹Ø¯.</p>
      {% endif %}
    </section>
  </div>

  {% include 'footer.html' %}

  <!-- JS: Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
  <script>
    function toggleMenu() {
      const menu = document.getElementById('sideMenu');
      menu.style.right = (menu.style.right === '0px') ? '-250px' : '0px';
    }
  </script>

  <!-- JS: Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© -->
  <script>
    function sharePoem(text) {
      const encodedText = encodeURIComponent("ğŸ“œ Ø¨ÙŠØª Ø£Ø¹Ø¬Ø¨Ù†ÙŠ:\n\n" + text + "\n\nÙ…Ù† Ø¬Ø²ÙŠØ±Ø© Ø§Ù„Ø¹Ø±Ø¨");
      const shareUrl = window.location.href;const modal = document.createElement('div');
      modal.id = "shareModal";
      modal.style = 
        position: fixed;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px #aaa;
        z-index: 9999;
        text-align: center;
      ;
      modal.innerHTML = 
        <p style="margin-bottom: 10px;">ğŸ”— Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙŠØª:</p>
        <a href="https://wa.me/?text=${encodedText}" target="_blank" style="display:inline-block;margin:5px;color:white;background:#25D366;padding:10px 20px;border-radius:6px;">ÙˆØ§ØªØ³Ø§Ø¨</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}" target="_blank" style="display:inline-block;margin:5px;color:white;background:#4267B2;padding:10px 20px;border-radius:6px;">ÙÙŠØ³Ø¨ÙˆÙƒ</a>
        <a href="https://twitter.com/intent/tweet?text=${encodedText}" target="_blank" style="display:inline-block;margin:5px;color:white;background:#1DA1F2;padding:10px 20px;border-radius:6px;">ØªÙˆÙŠØªØ±</a>
        <br><br>
        <button onclick="document.body.removeChild(document.getElementById('shareModal'))" style="margin-top:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
      ;
      document.body.appendChild(modal);
    }
  </script>
</body>
</html>