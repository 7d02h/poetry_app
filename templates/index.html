<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>الصفحة الرئيسية - جزيرة العرب</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <!-- زر القائمة الجانبية -->
  <div id="menuToggle" onclick="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- القائمة الجانبية -->
  <nav id="sideMenu">
    <ul>
      <li><a href="{{ url_for('my_profile') }}">👤 صفحتي</a></li>
      <li><a href="#">💬 تواصل معنا</a></li>
      <li><a href="#">⚙️ الإعدادات</a></li>
      <li><a href="{{ url_for('set_language', lang_code='ar') }}">🇸🇦 العربية</a></li>
      <li><a href="{{ url_for('set_language', lang_code='en') }}">🇬🇧 English</a></li>
      <li><a href="{{ url_for('logout') }}">🚪 تسجيل الخروج</a></li>
    </ul>
  </nav>

  <div class="container">
    <h1>جزيرة العرب</h1>

    <div style="text-align: right; margin-bottom: 20px;">
      مرحبًا، <a href="{{ url_for('my_profile') }}">{{ username }}</a> |
      <a href="{{ url_for('logout') }}">تسجيل الخروج</a>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- أفضل ٣ أبيات -->
    <section>
      <h2>🌟 أفضل ٣ أبيات اليوم</h2>
      {% if top_poems %}
        {% for poem in top_poems %}
          <div class="poem">
            <p>{{ poem[1] }}</p>
            <p class="timestamp">{{ poem[5] }}</p>
            <div class="user-info">
              <img src="{{ url_for('static', filename='profile_pics/' + poem[4]) }}" alt="صورة المستخدم">
              <a href="{{ url_for('public_profile', username=poem[3]) }}">{{ poem[3] }}</a>
            </div>
            <div class="poem-footer">
              ❤️ {{ poem[2] }}
              {% if poem[3] == username %}
              <a href="{{ url_for('like', poem_id=poem[0], like_count=1) }}">❤️ Like</a>
                | <a href="{{ url_for('delete', poem_id=poem[0]) }}">🗑️ حذف</a>
              {% endif %}
              | <a href="#" onclick="sharePoem({{ poem[1]|escape }})">🏌🏻 مشاركة</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>لا يوجد مشاركات اليوم.</p>
      {% endif %}
    </section>

    <!-- نشر بيت -->
    <section>
      <h2>✍️ انشر بيتك</h2>
      <form action="{{ url_for('submit') }}" method="POST">
        <textarea name="text" placeholder="اكتب بيتك الشعري هنا..." required></textarea>
        <button type="submit">نشر</button>
      </form>
    </section>

    <!-- جميع الأبيات -->
    <section>
      <h2>📚 كل الأبيات</h2>
      {% if all_poems %}
        {% for poem in all_poems %}
          <div class="poem">
            <p>{{ poem[1] }}</p>
            <p class="timestamp">{{ poem[5] }}</p>
            <div class="user-info">
              <img src="{{ url_for('static', filename='profile_pics/' + poem[4]) }}" alt="صورة المستخدم">
              <a href="{{ url_for('public_profile', username=poem[3]) }}">{{ poem[3] }}</a>
            </div>
            <div class="poem-footer">
              <a href="{{ url_for('like', poem_id=poem[0], like_count=1) }}">❤️ Like</a>
              {% if poem[3] == username %}
                | <a href="{{ url_for('delete', poem_id=poem[0]) }}">🗑️ حذف</a>
              {% endif %}
              | <a href="#" onclick="sharePoem({{ poem[1]|escape }})">🏌🏻 مشاركة</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>لا توجد أبيات منشورة بعد.</p>
      {% endif %}
    </section>
  </div>

  {% include 'footer.html' %}

  <!-- JS: القائمة الجانبية -->
  <script>
    function toggleMenu() {
      const menu = document.getElementById('sideMenu');
      menu.style.right = (menu.style.right === '0px') ? '-250px' : '0px';
    }
  </script>

  <!-- JS: زر المشاركة -->
  <script>
    function sharePoem(text) {
      const encodedText = encodeURIComponent("📜 بيت أعجبني:\n\n" + text + "\n\nمن جزيرة العرب");
      const shareUrl = window.location.href;const modal = document.createElement('div');
      modal.id = "shareModal";
      modal.style = 
        position: fixed;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px #aaa;
        z-index: 9999;
        text-align: center;
      ;
      modal.innerHTML = 
        <p style="margin-bottom: 10px;">🔗 شارك هذا البيت:</p>
        <a href="https://wa.me/?text=${encodedText}" target="_blank" style="display:inline-block;margin:5px;color:white;background:#25D366;padding:10px 20px;border-radius:6px;">واتساب</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}" target="_blank" style="display:inline-block;margin:5px;color:white;background:#4267B2;padding:10px 20px;border-radius:6px;">فيسبوك</a>
        <a href="https://twitter.com/intent/tweet?text=${encodedText}" target="_blank" style="display:inline-block;margin:5px;color:white;background:#1DA1F2;padding:10px 20px;border-radius:6px;">تويتر</a>
        <br><br>
        <button onclick="document.body.removeChild(document.getElementById('shareModal'))" style="margin-top:10px;">إغلاق</button>
      ;
      document.body.appendChild(modal);
    }
  </script>
</body>
</html>